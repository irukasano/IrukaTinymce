/**
 * Justboil.me - a TinyMCE image upload plugin
 * jbimages/plugin.js
 *
 * Released under Creative Commons Attribution 3.0 Unported License
 *
 * License: http://creativecommons.org/licenses/by/3.0/
 * Plugin info: http://justboil.me/
 * Author: Viktor Kuzhelnyi
 *
 * Version: 2.3 released 23/06/2013
 */

tinymce.PluginManager.add('jbimages', function(editor, url) {
	
	var dir = editor.baseURI.directory;
	dir = dir.substring(0, dir.lastIndexOf("/"));
	dir = dir.substring(0, dir.lastIndexOf("/"));
	
	var base_url = location.protocol + '//' + location.host + dir;
	var url = base_url + "/images/dialog";
	
	console.log(url);
	
	function jbBox() {
		console.log(editor);
		editor.windowManager.open({
			title: 'Upload an image',
			url : url,
			width : 300,
			height: 300,
			buttons: [{
				text: 'Upload',
				classes:'widget btn primary first abs-layout-item',
				disabled : true,
				onclick: 'close'
			},
			{
				text: 'Close',
				onclick: 'close'
			}]
		});

	}
	
	// Add a button that opens a window
	editor.addButton('jbimages', {
		tooltip: 'Upload an image',
		icon : 'image',
		text: 'Upload',
		onclick: jbBox
	});

	// Adds a menu item to the tools menu
	editor.addMenuItem('jbimages', {
		text: 'Upload an image',
		icon : 'image',
		context: 'insert',
		onclick: jbBox
	});
});
